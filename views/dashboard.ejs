<!--<% /* views/dashboard.ejs - Content for main_layout.ejs */ %>
<% /* 'title' and 'pageTitle' are passed from the dashboard route handler in app.js */ %>
<% /* main_layout.ejs includes Bootstrap, _messages.ejs, _main_navbar.ejs, etc. */ %>-->

<% if (typeof dashboard_error !== 'undefined' && dashboard_error) { %>
<div class="alert alert-danger" role="alert">
  <%= dashboard_error %>
</div>
<% } %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <% if (user) { %>
  <span class="fs-5">Welcome back, <%= user.first_name || user.username %>!</span>
  <% } %>
  <a href="/projects/create" class="btn btn-success"><i class="fas fa-plus me-2"></i>Create New Project</a>
</div>

<% if (user) { %>
<p class="lead">This is your personal space within Avenircon. Manage your projects and tasks efficiently.</p>
<hr class="mb-4">

<h4>My Projects Overview</h4>

<% if (typeof projects !== 'undefined' && projects.length > 0) { %>
<div class="row">
  <% projects.forEach(function(project) { %>
  <div class="col-md-6 col-lg-4 mb-4">
    <div class="card h-100 shadow-sm project-card">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">
          <a href="/projects/<%= project.id %>/details" class="text-decoration-none stretched-link"> 
            <% if (project.project_code) { %>
            <span class="text-muted me-1 small">[<%= project.project_code %>]</span>
            <% } %>
            <%= project.name %>
          </a>
        </h5>
        <p class="card-text small text-muted flex-grow-1"><%= project.description ? project.description.substring(0, 100) + (project.description.length > 100 ? '...' : '') : 'No description.' %></p>
        
        <!--<%# ----- NEW: Project Stats ----- %>-->
        <div class="mt-2 mb-3">
            <div class="mb-2">
                <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">Overall Progress</small>
                    <small class="text-muted"><%= project.overallProgress %>%</small>
                </div>
                <div class="progress" style="height: 10px;">
                    <div class="progress-bar bg-primary" role="progressbar" style="width: <%= project.overallProgress %>%;" aria-valuenow="<%= project.overallProgress %>" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
           

            <div class="progress-bar bg-success" role="progressbar"
     style="width: <%= project.overallProgress %>%;"
     aria-valuenow="<%= project.overallProgress %>"
     aria-valuemin="0" aria-valuemax="100">
    <%= project.overallProgress %>%
</div>
 </div>

            <div class="d-flex justify-content-between text-muted small">
                <span>Tasks: <%= project.completedTasks %> / <%= project.totalTasks %> Done</span>
                <% if (project.overdueTasksCount > 0) { %>
                    <span class="text-danger fw-bold">
                        <i class="fas fa-exclamation-triangle me-1"></i><%= project.overdueTasksCount %> Overdue
                    </span>
                <% } else { %>
                    <span><i class="fas fa-check-circle text-success me-1"></i>On Track</span>
                <% } %>
            </div>
        </div>

        

        <div class="mt-auto">  
          <p class="card-text mb-1"><small class="text-muted">Client: <%= project.client_name || 'N/A' %></small></p>
          <% if (project.creator_username) { %>
          <p class="card-text mb-1"><small class="text-muted">Created by: <%= project.creator_username %></small></p>
          <% } %>
          <p class="card-text mb-2">
            <small class="text-muted">
              Status: <span class="badge bg-<%= project.status === 'Completed' ? 'success' : (project.status === 'Active' || project.status === 'Planning' || project.status === 'InProgress' ? 'primary' : (project.status === 'On Hold' ? 'warning' : 'secondary')) %>">
                <%= project.status %>
              </span>
            </small>
          </p>
             <a href="/projects/<%= project.id %>/details" class="btn btn-sm btn-outline-primary">View Details</a>
        </div>
      </div>
    </div>
  </div>
  <% }); %>
</div>

<% } else { %>
<div class="alert alert-info text-center py-4">
  <i class="fas fa-folder-open fa-3x mb-3 d-block"></i>
  <h5 class="alert-heading">No Projects Yet!</h5>
  <p>You haven't created or been assigned to any projects. Get started by creating your first one.</p>
  <a href="/projects/create" class="btn btn-primary"><i class="fas fa-plus me-2"></i>Create Your First Project</a>
</div>
<% } %>

<% } %>

