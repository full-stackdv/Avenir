<%# views/admin/communication/notification_templates/list.ejs %>
<div class="container-fluid mt-4">
  <%- include('../../../partials/_messages') %>
  
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h4 class="card-title mb-0"><i class="fas fa-envelope-open-text mr-2"></i>Email Notification Templates</h4>
    </div>
    <div class="card-body">
      <p class="text-muted">Manage the content of automated emails sent by the system. Certain templates may not be customizable if they are critical for system functionality.</p>
      <% if (templates && templates.length > 0) { %>
      <div class="table-responsive">
        <table class="table table-striped table-hover table-sm">
          <thead>
            <tr>
              <th>Template Key</th>
              <th>Description</th>
              <th>Last Updated</th>
              <th>Customizable</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% templates.forEach(template => { %>
            <tr>
              <td><code><%= template.template_key %></code></td>
              <td><%= template.description %></td>
              <td><%= new Date(template.updated_at).toLocaleString() %></td>
              <td>
                <% if (template.is_customizable) { %>
                <span class="badge badge-success">Yes</span>
                <% } else { %>
                <span class="badge badge-secondary">No</span>
                <% } %>
              </td>
              <td>
                <a href="/admin/communication/notification-templates/<%= template.template_key %>/edit" class="btn btn-warning btn-sm" title="Edit Template">
                  <i class="fas fa-edit"></i> Edit
                </a>
                <form action="/admin/communication/notification-templates/<%= template.template_key %>/send-test" method="POST" style="display: inline;" onsubmit="return confirm('Send a test email for this template to your admin email address?');">
                  <button type="submit" class="btn btn-info btn-sm ml-1" title="Send Test Email">
                    <i class="fas fa-paper-plane"></i> Test
                  </button>
                </form>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
      <% } else { %>
      <div class="alert alert-info text-center">
        No notification templates found. You may need to seed the database.
      </div>
      <% } %>
    </div>
  </div>
</div>