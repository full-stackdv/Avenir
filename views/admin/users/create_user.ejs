<% /* views/admin/users/create_user.ejs */ %>
<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/admin">Admin Dashboard</a></li>
            <li class="breadcrumb-item"><a href="/admin/users">User Management</a></li>
            <li class="breadcrumb-item active" aria-current="page">Add New User</li>
        </ol>
    </nav>

    <h2><%= pageTitle %></h2>

    <%- include('../../partials/_messages', { errors: errors }) %>

    <div class="card shadow-sm">
        <div class="card-body">
            <form action="/admin/users/create" method="POST">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="username" class="form-label">Username <span class="text-danger">*</span></label>
                        <input type="text" class="form-control <%= errors.find(e => e.param === 'username') ? 'is-invalid' : '' %>"
                               id="username" name="username" value="<%= formData.username || '' %>" required>
                        <% errors.filter(e => e.param === 'username').forEach(error => { %><div class="invalid-feedback"><%= error.msg %></div><% }); %>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="email" class="form-label">Email Address <span class="text-danger">*</span></label>
                        <input type="email" class="form-control <%= errors.find(e => e.param === 'email') ? 'is-invalid' : '' %>"
                               id="email" name="email" value="<%= formData.email || '' %>" required>
                        <% errors.filter(e => e.param === 'email').forEach(error => { %><div class="invalid-feedback"><%= error.msg %></div><% }); %>
                    </div>
                </div>

                <div class="row">
                     <div class="col-md-6 mb-3">
                        <label for="password" class="form-label">Password <span class="text-danger">*</span></label>
                        <input type="password" class="form-control <%= errors.find(e => e.param === 'password' || e.param ==='confirm_password') ? 'is-invalid' : '' %>"
                               id="password" name="password" required>
                        <% errors.filter(e => e.param === 'password').forEach(error => { %><div class="invalid-feedback"><%= error.msg %></div><% }); %>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="confirm_password" class="form-label">Confirm Password <span class="text-danger">*</span></label>
                        <input type="password" class="form-control <%= errors.find(e => e.param === 'confirm_password') ? 'is-invalid' : '' %>"
                               id="confirm_password" name="confirm_password" required>
                        <% errors.filter(e => e.param === 'confirm_password').forEach(error => { %><div class="invalid-feedback"><%= error.msg %></div><% }); %>
                    </div>
                </div>


                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="first_name" class="form-label">First Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control <%= errors.find(e => e.param === 'first_name') ? 'is-invalid' : '' %>"
                               id="first_name" name="first_name" value="<%= formData.first_name || '' %>" required>
                        <% errors.filter(e => e.param === 'first_name').forEach(error => { %><div class="invalid-feedback"><%= error.msg %></div><% }); %>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="last_name" class="form-label">Last Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control <%= errors.find(e => e.param === 'last_name') ? 'is-invalid' : '' %>"
                               id="last_name" name="last_name" value="<%= formData.last_name || '' %>" required>
                        <% errors.filter(e => e.param === 'last_name').forEach(error => { %><div class="invalid-feedback"><%= error.msg %></div><% }); %>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="company_name" class="form-label">Company Name (Optional)</label>
                    <input type="text" class="form-control" id="company_name" name="company_name" value="<%= formData.company_name || '' %>">
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="role" class="form-label">Role <span class="text-danger">*</span></label>
                        <select class="form-select <%= errors.find(e => e.param === 'role') ? 'is-invalid' : '' %>"
                                id="role" name="role" required>
                            <% availableRoles.forEach(roleOpt => { %>
                                <option value="<%= roleOpt %>" <%= formData.role === roleOpt ? 'selected' : (roleOpt === 'User' && !formData.role ? 'selected' : '') %>>
                                    <%= roleOpt %>
                                </option>
                            <% }); %>
                        </select>
                         <% errors.filter(e => e.param === 'role').forEach(error => { %><div class="invalid-feedback"><%= error.msg %></div><% }); %>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="is_active_status" class="form-label">Account Status <span class="text-danger">*</span></label>
                        <select class="form-select" id="is_active_status" name="is_active_status" required>
                            <option value="active" <%= (formData.is_active_status === 'active' || typeof formData.is_active_status === 'undefined') ? 'selected' : '' %>>Active</option>
                            <option value="inactive" <%= formData.is_active_status === 'inactive' ? 'selected' : '' %>>Inactive</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn btn-success"><i class="fas fa-user-plus"></i> Create User Account</button>
                <a href="/admin/users" class="btn btn-secondary">Cancel</a>
            </form>
        </div>
    </div>
</div>