<% /* views/projects/upload_csv.ejs */ %>
<div class="container mt-4 mb-5">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="/projects">Projects</a></li>
            <li class="breadcrumb-item active" aria-current="page">Upload Projects CSV</li>
        </ol>
    </nav>

    <h2><%= pageTitle %></h2>
    <p>Upload a CSV file to create multiple projects at once.</p>
    <p>Expected CSV Headers: <code>name</code>, <code>project_code</code> (optional), <code>description</code> (optional), <code>client_name</code> (optional), <code>start_date</code> (YYYY-MM-DD), <code>end_date</code> (YYYY-MM-DD, optional), <code>budget</code> (optional, number), <code>project_manager_username</code> (optional, existing username).</p>
    <p><a href="./samples/sample_projects.csv" download>Download Sample Projects CSV Template</a></p> <%# Replace with actual path or remove %>


    <%- include('../partials/_messages', { errors: errors }) %>

    <% if (typeof successCount !== 'undefined' || typeof failureCount !== 'undefined') { %>
        <div class="alert alert-info">
            <p class="mb-1"><strong>Import Summary:</strong></p>
            <% if (typeof successCount !== 'undefined') { %>
                <p class="mb-1 text-success"><%= successCount %> project(s) imported successfully.</p>
            <% } %>
            <% if (typeof failureCount !== 'undefined' && failureCount > 0) { %>
                <p class="mb-0 text-danger"><%= failureCount %> project(s) failed to import.</p>
            <% } %>
        </div>
    <% } %>

    <% if (detailedErrors && detailedErrors.length > 0) { %>
        <div class="mt-3">
            <h5>Detailed Import Errors:</h5>
            <table class="table table-sm table-bordered">
                <thead class="table-light">
                    <tr>
                        <th>CSV Row</th>
                        <th>Errors</th>
                        <th>Data</th>
                    </tr>
                </thead>
                <tbody>
                    <% detailedErrors.forEach(err => { %>
                        <tr>
                            <td><%= err.row %></td>
                            <td>
                                <ul>
                                    <% err.errors.forEach(msg => { %>
                                        <li><%= msg %></li>
                                    <% }); %>
                                </ul>
                            </td>
                            <td><pre style="font-size: 0.8em; white-space: pre-wrap; word-break: break-all;"><%= JSON.stringify(err.data, null, 2) %></pre></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    <% } %>


    <form action="/projects/upload-csv" method="POST" enctype="multipart/form-data" class="mt-3">
        <div class="mb-3">
            <label for="projects_csv_file" class="form-label">Select CSV File</label>
            <input class="form-control" type="file" id="projects_csv_file" name="projects_csv_file" accept=".csv" required>
        </div>
        <button type="submit" class="btn btn-primary"><i class="fas fa-upload me-1"></i> Upload and Process Projects</button>
        <a href="/projects/create" class="btn btn-secondary">Cancel</a>
    </form>
</div>