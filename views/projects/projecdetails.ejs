<nav aria-label="breadcrumb mb-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="/projects">Projects</a></li>
        <li class="breadcrumb-item active" aria-current="page">
            <% if (project && project.project_code) { %>
                [<%= project.project_code %>]
            <% } %>
            <%= (project && project.name) ? project.name : 'Project Details' %>
        </li>
    </ol>
</nav>

<% if (project) { %>
    <div class="d-flex justify-content-between align-items-center mb-3">
        <% /* The main pageTitle is rendered by the layout */ %>
        <div>
            <a href="/projects/<%= project.id %>/edit" class="btn btn-sm btn-outline-primary me-2">
                <i class="fas fa-edit me-1"></i> Edit Project
            </a>
            <form action="/projects/<%= project.id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this project? This will also delete all associated tasks and cannot be undone.');">
                <button type="submit" class="btn btn-sm btn-outline-danger">
                    <i class="fas fa-trash-alt me-1"></i> Delete
                </button>
            </form>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Project Overview</h5>
                </div>
                <div class="card-body">
                    <p>
                        <strong>Description:</strong><br>
                        <%- project.description ? project.description.replace(/\n/g, '<br>') : 'No description provided.' %>
                    </p>
                </div>
            </div>
            
            <div class="card shadow-sm mb-4">
                 <div class="card-header">
                    <h5 class="mb-0">Key Information</h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm table-borderless project-meta-table">
                        <tbody>
                            <tr><th scope="row">Project Code:</th><td><%= project.project_code || 'N/A' %></td></tr>
                            <tr><th scope="row">Status:</th><td><span class="badge bg-<%= project.status === 'Completed' ? 'success' : (project.status === 'Active' ? 'primary' : (project.status === 'On Hold' ? 'warning' : 'secondary')) %>"><%= project.status %></span></td></tr>
                            <tr><th scope="row">Client:</th><td><%= project.client_name || 'N/A' %></td></tr>
                            <tr><th scope="row">Budget:</th><td><%= project.budget ? 'ETB ' + parseFloat(project.budget).toFixed(2) : 'N/A' %></td></tr>
                            <tr><th scope="row">Start Date:</th><td><%= project.start_date_formatted || (project.start_date ? new Date(project.start_date).toLocaleDateString() : 'N/A') %></td></tr>
                            <tr><th scope="row">End Date:</th><td><%= project.end_date_formatted || (project.end_date ? new Date(project.end_date).toLocaleDateString() : 'N/A') %></td></tr>
                            <tr><th scope="row">Project Manager:</th><td><%= project.project_manager_username || (project.project_manager_id ? `User ID: ${project.project_manager_id}` : 'N/A') %></td></tr>
                            <tr><th scope="row">Created By:</th><td><%= project.creator_username || `User ID: ${project.created_by_id}` %></td></tr>
                            <tr><th scope="row">Created At:</th><td><%= project.created_at_formatted || new Date(project.created_at).toLocaleString() %></td></tr>
                            <tr><th scope="row">Last Updated:</th><td><%= project.updated_at_formatted || new Date(project.updated_at).toLocaleString() %></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card shadow-sm">
                <div class="card-header"><h5 class="mb-0">Project Elements</h5></div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><a href="#project-tasks-section" class="text-decoration-none"><i class="fas fa-tasks me-2"></i>Tasks (WBS)</a></li>
                    <li class="list-group-item"><a href="/projects/<%= project.id %>/documents" class="text-decoration-none"><i class="fas fa-folder-open me-2"></i>Documents</a></li>
                    <li class="list-group-item"><a href="/projects/<%= project.id %>/logs" class="text-decoration-none"><i class="fas fa-clipboard-list me-2"></i>Daily Logs</a></li>
                    <!-- Add other elements -->
                </ul>
            </div>
        </div>
    </div>
    
     <div class="container container-fluid mt-4 mb-5">
    <div class="mt-4" id="project-tasks-section">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>Project Tasks (WBS)</h4>
            <a href="/projects/<%= project.id %>/tasks/create" class="btn btn-success btn-sm">
                <i class="fas fa-plus me-1"></i> Add New Task
            </a>
        </div>
        
        <% if (typeof tasks !== 'undefined' && tasks.length > 0) { %>

            <div class="task-list-containerc container bg-white p-3 rounded shadow-sm">
                <% tasks.forEach(function(task) { %>
                    <%- include('../partials/_task_item', { task: task, project: project, level: 0 }) %>
                <% }); %>
            </div>
        <% } else { %>
            <div class="alert alert-light text-center py-3" role="alert">
                No tasks have been added to this project yet.
                <a href="/projects/<%= project.id %>/tasks/create" class="alert-link d-block mt-2">Add the first task now!</a>
            </div>
        <% } %>
    </div>
     </div>
<% } else { %>
    <div class="alert alert-warning" role="alert">
        Project details could not be loaded. Please try again or contact support.
    </div>
<% } %>

