<% /* views/projects/logs/details.ejs - Content for main_layout.ejs */ %>

<nav aria-label="breadcrumb mb-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="/projects/<%= project.id %>/details"><%= project.name %></a></li>
        <li class="breadcrumb-item"><a href="/projects/<%= project.id %>/logs">Daily Logs</a></li>
        <li class="breadcrumb-item active" aria-current="page">Log for <%= (log && log.log_date_formatted) ? log.log_date_formatted : 'Details' %></li>
    </ol>
</nav>


<% if (log) { %>
    <div class="card shadow-sm">
        <!-- <div class="card-header d-flex justify-content-between align-items-center">
             <h2 class="mb-0"><%= pageTitle %> - Project: <a href="/projects/<%= project.id %>/details"><%= project.name %></a></h2>
            <h5 class="mb-0">Daily Log: <%= log.log_date_formatted %></h5>
            <div>
                <% /* Edit/Delete buttons for future */ %>
            </div>
        </div>-->

         <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0"><%= pageTitle %> - Project: <a href="/projects/<%= project.id %>/details"><%= project.name %></a></h2>
        
        <div>
            <%# Edit and Delete Log buttons %>
            <a href="/projects/<%= project.id %>/logs/<%= log.id %>/edit" class="btn btn-outline-primary btn-sm me-2">
                <i class="fas fa-edit me-1"></i> Edit Log
            </a>
            <form action="/projects/<%= project.id %>/logs/<%= log.id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this daily log? This action cannot be undone.');">
                <button type="submit" class="btn btn-outline-danger btn-sm">
                    <i class="fas fa-trash-alt me-1"></i> Delete Log
                </button>
            </form>
        </div>

    </div>
        <%- include('../../partials/_messages') %>

        <div class="card-body p-4">
            <dl class="row">
                <dt class="col-sm-3">Project:</dt>
                <dd class="col-sm-9"><a href="/projects/<%= project.id %>/details"><%= project.name %></a></dd>

                <dt class="col-sm-3">Logged By:</dt>
                <dd class="col-sm-9"><%= log.logger_username %></dd>

                <dt class="col-sm-3">Logged At:</dt>
                <dd class="col-sm-9"><%= log.created_at_formatted %></dd>
                
                <% if (log.updated_at && new Date(log.updated_at).getTime() !== new Date(log.created_at).getTime()) { %>
                    <dt class="col-sm-3">Last Updated:</dt>
                    <dd class="col-sm-9"><%= new Date(log.updated_at).toLocaleString() %></dd>
                <% } %>

                <dt class="col-sm-3 mt-3">Weather Conditions:</dt>
                <dd class="col-sm-9 mt-3"><%= log.weather_conditions || 'N/A' %></dd>

                <dt class="col-sm-3">Site Conditions:</dt>
                <dd class="col-sm-9"><%= log.site_conditions || 'N/A' %></dd>

                <dt class="col-sm-3 mt-3">Work Performed:</dt>
                <dd class="col-sm-9 mt-3"><pre class="log-pre-text"><%= log.work_performed %></pre></dd>

                <dt class="col-sm-3 mt-3">Delays or Issues:</dt>
                <dd class="col-sm-9 mt-3"><pre class="log-pre-text"><%= log.delays_or_issues || 'None reported' %></pre></dd>
            </dl>
        </div>
        <div class="card-footer">
             <a href="/projects/<%= project.id %>/logs" class="btn btn-outline-secondary"><i class="fas fa-arrow-left me-1"></i> Back to Logs List</a>
        </div>
    </div>
<% } else { %>
    <div class="alert alert-danger">Daily log details could not be loaded or the log does not exist.</div>
<% } %>
<style>
    .log-pre-text { white-space: pre-wrap; font-family: inherit; font-size: inherit; }
    .project-meta-table th { width: 25%; font-weight: 500; }
    .project-meta-table td { word-break: break-word; }
</style>

