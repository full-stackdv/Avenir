
<!-- views/projects/details.ejs INDEX BEFORE PROJECT/TASK CODE -->
<%- include('../partials/_header', { title: project.name + ' - Project Details'}) %>

<div class="container mt-4 mb-5">
    <% if (project) { %>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
                <li class="breadcrumb-item active" aria-current="page"><%= project.name %></li>
            </ol>
        </nav>

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="mb-0"><%= project.name %></h1>
            <div>
                <a href="/projects/<%= project.id %>/edit" class="btn btn-sm btn-outline-primary me-2">
                    <i class="fas fa-edit me-1"></i> Edit Project
                </a>
                <form action="/projects/<%= project.id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this project? This will also delete all associated tasks and cannot be undone.');">
                    <button type="submit" class="btn btn-sm btn-outline-danger ms-2">
                        <i class="fas fa-trash-alt me-1"></i> Delete
                    </button>
                </form>
            </div>
        </div>
        <hr>

        <!-- ... (Project Overview and Key Information sections remain the same) ... -->
        <div class="row">
            <div class="col-md-8">
                <h4>Project Overview</h4>
                <p>
                    <strong>Description:</strong><br>
                    <%- project.description ? project.description.replace(/\n/g, '<br>') : 'No description provided.' %>
                </p>
                
                <h4 class="mt-4">Key Information</h4>
                <table class="table table-bordered table-striped">
                    <tbody>
                        <tr>
                            <th scope="row" style="width: 30%;">Status</th>
                            <td><span class="badge bg-<%= project.status === 'Completed' ? 'success' : (project.status === 'Active' ? 'primary' : (project.status === 'On Hold' ? 'warning' : 'secondary')) %>"><%= project.status %></span></td>
                        </tr>
                        <tr>
                            <th scope="row">Client Name</th>
                            <td><%= project.client_name || 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Budget</th>
                            <td><%= project.budget ? 'ETB' + parseFloat(project.budget).toFixed(2) : 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Start Date</th>
                            <td><%= project.start_date ? new Date(project.start_date).toLocaleDateString() : 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">End Date</th>
                            <td><%= project.end_date ? new Date(project.end_date).toLocaleDateString() : 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Project Manager</th>
                            <td>
                                <% if (project.project_manager_username) { %>
                                    <%= project.project_manager_username %>
                                <% } else if (project.project_manager_id) { %>
                                    User ID: <%= project.project_manager_id %> (Username not found)
                                <% } else { %>
                                    N/A
                                <% } %>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Created By</th>
                            <td>
                                <% if (project.creator_username) { %>
                                    <%= project.creator_username %>
                                <% } else { %>
                                     User ID: <%= project.created_by_id %> (Username not found)
                                <% } %>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Created At</th>
                            <td><%= new Date(project.created_at).toLocaleString() %></td>
                        </tr>
                         <tr>
                            <th scope="row">Last Updated</th>
                            <td><%= new Date(project.updated_at).toLocaleString() %></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">Project Elements</div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><a href="#project-tasks-section">Tasks (WBS)</a></li>
                        <li class="list-group-item"><a href="/projects/<%= project.id %>/documents">Documents</a></li>
                        <li class="list-group-item"><a href="/projects/<%= project.id %>/logs">Daily Logs</a></li>
                    </ul>
                </div>
            </div>
        </div>


        <!-- Section for Tasks List -->
        <div class="mt-5" id="project-tasks-section">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3>Project Tasks (WBS)</h3>
                <a href="/projects/<%= project.id %>/tasks/create" class="btn btn-success">
                    <i class="fas fa-plus me-1"></i> Add New Task
                </a>
            </div>

            <%- include('../partials/_messages') %>

            <% if (typeof tasks !== 'undefined' && tasks.length > 0) { %>
                <div class="list-group">
                    <% tasks.forEach(function(task) { %>
                        <%-/* Call the new partial for each root task */%>
                        <%- include('../partials/_task_item', { task: task, project: project, level: 0 }) %>
                    <% }); %>
                </div>
            <% } else { %>
                <div class="alert alert-light" role="alert">
                    No tasks have been added to this project yet.
                    <a href="/projects/<%= project.id %>/tasks/create" class="alert-link">Add the first task now!</a>
                </div>
            <% } %>
        </div>

    <% } else { %>
        <div class="alert alert-warning" role="alert">
            Project details could not be loaded.
        </div>
    <% } %>
</div>

<%- include('../partials/_footer') %>



<!--the index revised version to contain hairerchy -->


<%- include('../partials/_header', { title: project.name + ' - Project Details'}) %>

<div class="container mt-4 mb-5">
    <% if (project) { %>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
                <li class="breadcrumb-item active" aria-current="page"><%= project.name %></li>
            </ol>
        </nav>

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="mb-0"><%= project.name %></h1>
            <div>
                <a href="/projects/<%= project.id %>/edit" class="btn btn-sm btn-outline-primary me-2">
                    <i class="fas fa-edit me-1"></i> Edit Project
                </a>
                <form action="/projects/<%= project.id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this project? This will also delete all associated tasks and cannot be undone.');">
                    <button type="submit" class="btn btn-sm btn-outline-danger ms-2">
                        <i class="fas fa-trash-alt me-1"></i> Delete
                    </button>
                </form>
            </div>
        </div>
        <hr>

        <div class="row">
            <div class="col-md-8">
                <h4>Project Overview</h4>
                <p>
                    <strong>Description:</strong><br>
                    <%- project.description ? project.description.replace(/\n/g, '<br>') : 'No description provided.' %>
                </p>
                
                <h4 class="mt-4">Key Information</h4>
                <table class="table table-bordered table-striped">
                    <tbody>
                        <tr>
                            <th scope="row" style="width: 30%;">Status</th>
                            <td><span class="badge bg-<%= project.status === 'Completed' ? 'success' : (project.status === 'Active' ? 'primary' : (project.status === 'On Hold' ? 'warning' : 'secondary')) %>"><%= project.status %></span></td>
                        </tr>
                        <tr>
                            <th scope="row">Client Name</th>
                            <td><%= project.client_name || 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Budget</th>
                            <td><%= project.budget ? '$' + parseFloat(project.budget).toFixed(2) : 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Start Date</th>
                            <td><%= project.start_date ? new Date(project.start_date).toLocaleDateString() : 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">End Date</th>
                            <td><%= project.end_date ? new Date(project.end_date).toLocaleDateString() : 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Project Manager</th>
                            <td>
                                <% if (project.project_manager_username) { %>
                                    <%= project.project_manager_username %>
                                <% } else if (project.project_manager_id) { %>
                                    User ID: <%= project.project_manager_id %> (Username not found)
                                <% } else { %>
                                    N/A
                                <% } %>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Created By</th>
                            <td>
                                <% if (project.creator_username) { %>
                                    <%= project.creator_username %>
                                <% } else { %>
                                     User ID: <%= project.created_by_id %> (Username not found)
                                <% } %>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Created At</th>
                            <td><%= new Date(project.created_at).toLocaleString() %></td>
                        </tr>
                         <tr>
                            <th scope="row">Last Updated</th>
                            <td><%= new Date(project.updated_at).toLocaleString() %></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">Project Elements</div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><a href="#project-tasks-section">Tasks (WBS)</a></li> <!-- Updated to be an anchor link -->
                        <li class="list-group-item"><a href="/projects/<%= project.id %>/documents">Documents</a></li>
                        <li class="list-group-item"><a href="/projects/<%= project.id %>/logs">Daily Logs</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Section for Tasks List -->
        <div class="mt-5" id="project-tasks-section">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3>Project Tasks</h3>
                <a href="/projects/<%= project.id %>/tasks/create" class="btn btn-success">
                    <i class="fas fa-plus me-1"></i> Add New Task
                </a>
            </div>

            <%- include('../partials/_messages') %>

            <% if (typeof tasks !== 'undefined' && tasks.length > 0) { %>
                <div class="list-group">
                    <% tasks.forEach(function(task) { %>
                        <div class="list-group-item list-group-item-action mb-2 shadow-sm">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1"><%= task.name %></h5>
                                <small>
                                    Status: <span class="badge bg-<%= task.status === 'Completed' ? 'success' : (task.status === 'InProgress' ? 'primary' : (task.status === 'ToDo' ? 'info' : (task.status === 'Blocked' ? 'danger' : 'secondary'))) %>">
                                        <%= task.status %>
                                    </span>
                                </small>
                            </div>
                            <% if (task.description) { %>
                                <p class="mb-1"><%= task.description.substring(0, 200) + (task.description.length > 200 ? '...' : '') %></p>
                            <% } %>
                            <!-- 
                            <small class="text-muted">
                                Priority: <%= task.priority || 'N/A' %>
                                <% if (task.start_date || task.end_date) { %>
                                    | Dates: <%= task.start_date ? new Date(task.start_date).toLocaleDateString() : 'N/A' %> - <%= task.end_date ? new Date(task.end_date).toLocaleDateString() : 'N/A' %>
                                <% } %>
                            --><!-- Display Task Creator and Assignee Usernames (once taskController is updated) -->
                             <!--   <br>
                                <% if (task.task_creator_username) { %>
                                    Created by: <%= task.task_creator_username %>
                                <% } else if (task.created_by_id) { %>
                                    Created by ID: <%= task.created_by_id %>
                                <% } %>
                                <% if (task.assignee_username) { %>
                                    | Assigned to: <%= task.assignee_username %>
                                <% } else if (task.assigned_to_id) { %>
                                    | Assigned to ID: <%= task.assigned_to_id %>
                                <% } %>
                            </small>
-->

                            <!-- Snippet from views/projects/details.ejs where tasks are listed -->

                            <small class="text-muted">
    Priority: <%= task.priority || 'N/A' %>
    <% if (task.start_date || task.end_date) { %>
        | Dates: <%= task.start_date ? new Date(task.start_date).toLocaleDateString() : 'N/A' %> - <%= task.end_date ? new Date(task.end_date).toLocaleDateString() : 'N/A' %>
    <% } %>
    <br>
    <% if (task.task_creator_username) { %>
        Created by: <%= task.task_creator_username %>
    <% } else if (task.created_by_id) { %> <!-- Fallback if username somehow not found but ID exists -->
        Created by ID: <%= task.created_by_id %>
    <% } %>
    <% if (task.assignee_username) { %>
        | Assigned to: <%= task.assignee_username %>
    <% } else if (task.assigned_to_id) { %> <!-- Fallback if username somehow not found but ID exists and username wasn't joined -->
        | Assigned to ID: <%= task.assigned_to_id %>
    <% } else { %> <!-- This handles the case where task.assigned_to_id is NULL -->
        | Assigned to: N/A 
    <% } %>
</small>

                            <div class="mt-2">
                                <a href="/projects/<%= project.id %>/tasks/<%= task.id %>/edit" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-edit me-1"></i> Edit Task
                                </a>
                                <form action="/projects/<%= project.id %>/tasks/<%= task.id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this task? This action cannot be undone.');">
                                    <button type="submit" class="btn btn-sm btn-outline-danger ms-2">
                                        <i class="fas fa-trash-alt me-1"></i> Delete
                                    </button>
                                </form>
                            </div>
                        </div>
                    <% }); %>
                </div>
            <% } else { %>
                <div class="alert alert-light" role="alert">
                    No tasks have been added to this project yet.
                    <a href="/projects/<%= project.id %>/tasks/create" class="alert-link">Add the first task now!</a>
                </div>
            <% } %>
        </div>

    <% } else { %>
        <div class="alert alert-warning" role="alert">
            Project details could not be loaded.
        </div>
    <% } %>
</div>

<%- include('../partials/_footer') %>










<%- include('../partials/_header', { title: title }) %> <% /* Ensure 'title' is passed from controller, e.g., project.name + ' - Project Details' */ %>

<div class="container mt-4 mb-5">
    <%- include('../partials/_messages') %> <% /* For displaying flash messages */ %>

    <% if (project) { %>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
                <li class="breadcrumb-item active" aria-current="page"><%= project.name %></li>
            </ol>
        </nav>

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="mb-0"><%= project.name %></h1>
            <div>
                <a href="/projects/<%= project.id %>/edit" class="btn btn-sm btn-outline-primary me-2">
                    <i class="fas fa-edit me-1"></i> Edit Project
                </a>
                <% /* Placeholder for Delete Project Button - to be implemented later */ %>
                <% /* 
                <form action="/projects/<%= project.id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this project and all its tasks? This action cannot be undone.');">
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                        <i class="fas fa-trash-alt me-1"></i> Delete Project
                    </button>
                </form> 
                */ %>
            </div>
        </div>
        <hr>

        <div class="row">
            <div class="col-md-8">
                <h4>Project Overview</h4>
                <p>
                    <strong>Description:</strong><br>
                    <%- project.description ? project.description.replace(/\n/g, '<br>') : '<span class="text-muted">No description provided.</span>' %>
                </p>
                
                <h4 class="mt-4">Key Information</h4>
                <table class="table table-bordered table-striped">
                    <tbody>
                        <tr>
                            <th scope="row" style="width: 30%;">Status</th>
                            <td><span class="badge bg-<%= project.status === 'Completed' ? 'success' : (project.status === 'Active' ? 'primary' : (project.status === 'On Hold' ? 'warning' : (project.status === 'Planning' ? 'info' : 'secondary'))) %>"><%= project.status %></span></td>
                        </tr>
                        <tr>
                            <th scope="row">Client Name</th>
                            <td><%= project.client_name || '<span class="text-muted">N/A</span>' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Budget</th>
                            <td><%= project.budget ? '$' + parseFloat(project.budget).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : '<span class="text-muted">N/A</span>' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Start Date</th>
                            <td><%= project.start_date ? new Date(project.start_date).toLocaleDateString() : '<span class="text-muted">N/A</span>' %></td>
                        </tr>
                        <tr>
                            <th scope="row">End Date</th>
                            <td><%= project.end_date ? new Date(project.end_date).toLocaleDateString() : '<span class="text-muted">N/A</span>' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Project Manager</th>
                            <td>
                                <% if (project.project_manager_username) { %>
                                    <%= project.project_manager_username %>
                                <% } else if (project.project_manager_id) { %>
                                    <span class="text-muted">User ID: <%= project.project_manager_id %> (Name not fetched)</span>
                                <% } else { %>
                                    <span class="text-muted">N/A</span>
                                <% } %>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Created By</th>
                            <td>
                                <% if (project.creator_username) { %>
                                    <%= project.creator_username %>
                                <% } else { %>
                                   <span class="text-muted">User ID: <%= project.created_by_id %> (Name not fetched)</span>
                                <% } %>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Created At</th>
                            <td><%= new Date(project.created_at).toLocaleString() %></td>
                        </tr>
                         <tr>
                            <th scope="row">Last Updated</th>
                            <td><%= new Date(project.updated_at).toLocaleString() %></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">Project Elements</div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><a href="#project-tasks-section">Tasks (WBS)</a></li> <!-- Anchor link to tasks section on this page -->
                        <li class="list-group-item disabled"><a href="#" tabindex="-1" aria-disabled="true">Documents (Coming Soon)</a></li>
                        <li class="list-group-item disabled"><a href="#" tabindex="-1" aria-disabled="true">Daily Logs (Coming Soon)</a></li>
                        <% /* Example for future:
                        <li class="list-group-item"><a href="/projects/<%= project.id %>/documents">Documents</a></li>
                        <li class="list-group-item"><a href="/projects/<%= project.id %>/logs">Daily Logs</a></li>
                        */ %>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Section for Tasks List -->
        <div class="mt-5" id="project-tasks-section">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3>Project Tasks</h3>
                <a href="/projects/<%= project.id %>/tasks/create" class="btn btn-success">
                    <i class="fas fa-plus me-1"></i> Add New Task
                </a>
            </div>

            <% if (typeof tasks !== 'undefined' && tasks.length > 0) { %>
                <div class="list-group">
                    <% tasks.forEach(function(task) { %>
                        <div class="list-group-item list-group-item-action flex-column align-items-start mb-2 shadow-sm">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1"><%= task.name %></h5>
                                <div class="task-actions">
                                    <span class="badge rounded-pill bg-<%= task.status === 'Completed' ? 'success' : (task.status === 'InProgress' ? 'primary' : (task.status === 'ToDo' ? 'info' : (task.status === 'Blocked' ? 'danger' : (task.status === 'Cancelled' ? 'secondary' : 'light')))) %> me-2">
                                        <%= task.status %>
                                    </span>
                                    <a href="/projects/<%= project.id %>/tasks/<%= task.id %>/edit" class="btn btn-sm btn-outline-secondary" title="Edit Task">
                                        <i class="fas fa-pencil-alt"></i> Edit
                                    </a>
                                    <% /* Placeholder for Delete Task Button - to be implemented later
                                    <form action="/projects/<%= project.id %>/tasks/<%= task.id %>/delete" method="POST" class="d-inline ms-1" onsubmit="return confirm('Are you sure you want to delete this task?');">
                                        <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete Task">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </form>
                                    */ %>
                                </div>
                            </div>
                            <% if (task.description) { %>
                                <p class="mb-1 text-muted" style="font-size: 0.9rem;"><%= task.description.substring(0, 150) + (task.description.length > 150 ? '...' : '') %></p>
                            <% } %>
                            <small class="text-muted">
                                Priority: <span class="fw-bold"><%= task.priority || 'N/A' %></span>
                                <% if (task.start_date || task.end_date) { %>
                                    | Dates: 
                                    <span class="fw-bold"><%= task.start_date ? new Date(task.start_date).toLocaleDateString() : 'N/A' %></span> to 
                                    <span class="fw-bold"><%= task.end_date ? new Date(task.end_date).toLocaleDateString() : 'N/A' %></span>
                                <% } %>
                                <% if (task.assignee_username) { %>
                                    | Assigned to: <span class="fw-bold"><%= task.assignee_username %></span>
                                <% } else if (task.assigned_to_id) { %>
                                    | Assigned to ID: <span class="fw-bold"><%= task.assigned_to_id %></span>
                                <% } %>
                            </small>
                        </div>
                    <% }); %>
                </div>
            <% } else { %>
                <div class="alert alert-light text-center" role="alert">
                    <i class="fas fa-tasks fa-2x mb-2 d-block"></i>
                    No tasks have been added to this project yet.
                    <br>
                    <a href="/projects/<%= project.id %>/tasks/create" class="alert-link">Add the first task now!</a>
                </div>
            <% } %>
        </div>

    <% } else { %>
        <div class="alert alert-warning" role="alert">
            <h4 class="alert-heading">Project Not Found!</h4>
            <p>The project details could not be loaded. It might have been deleted or you may not have permission to view it.</p>
            <hr>
            <p class="mb-0">Please check the project ID or <a href="/dashboard" class="alert-link">return to your dashboard</a>.</p>
        </div>
    <% } %>
</div>

<%- include('../partials/_footer') %>













<%- include('../partials/_header', { title: project.name + ' - Project Details'}) %> <!-- Title was 'title', not 'project.name...' in my version. Ensure `title` is passed from controller or use the string directly. Controller passes: `title: project.name + ' - Project Details'` so this should be: title: title -->

<div class="container mt-4 mb-5">
    <% if (project) { %>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
                <li class="breadcrumb-item active" aria-current="page"><%= project.name %></li>
            </ol>
        </nav>

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="mb-0"><%= project.name %></h1>
            <div>
                <a href="/projects/<%= project.id %>/edit" class="btn btn-sm btn-outline-primary me-2">
                    <i class="fas fa-edit me-1"></i> Edit Project
                </a>
            </div>
            
          
                <form action="/projects/<%= project.id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this project? This will also delete all associated tasks and cannot be undone.');">
                            <button type="submit" class="btn btn-sm btn-outline-danger ms-2">
                                <i class="fas fa-trash-alt me-1"></i> Delete
                            </button>
                            </form>
        </div>
        <hr>

        <div class="row">
            <div class="col-md-8">
                <h4>Project Overview</h4>
                <p>
                    <strong>Description:</strong><br>
                    <%- project.description ? project.description.replace(/\n/g, '<br>') : 'No description provided.' %>
                </p>
                
                <h4 class="mt-4">Key Information</h4>
                <table class="table table-bordered table-striped">
                    <tbody>
                        <tr>
                            <th scope="row" style="width: 30%;">Status</th>
                            <td><span class="badge bg-<%= project.status === 'Completed' ? 'success' : (project.status === 'Active' ? 'primary' : (project.status === 'On Hold' ? 'warning' : 'secondary')) %>"><%= project.status %></span></td>
                        </tr>
                        <tr>
                            <th scope="row">Client Name</th>
                            <td><%= project.client_name || 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Budget</th>
                            <td><%= project.budget ? '$' + parseFloat(project.budget).toFixed(2) : 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Start Date</th>
                            <td><%= project.start_date ? new Date(project.start_date).toLocaleDateString() : 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">End Date</th>
                            <td><%= project.end_date ? new Date(project.end_date).toLocaleDateString() : 'N/A' %></td>
                        </tr>
                        <tr>
                            <th scope="row">Project Manager</th>
                            <td>
                                <% if (project.project_manager_id) { %>
                                    User ID: <%= project.project_manager_id %> (Name to be fetched)
                                <% } else { %>
                                    N/A
                                <% } %>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Created By</th>
                            <td>
                                User ID: <%= project.created_by_id %> (Name to be fetched)
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Created At</th>
                            <td><%= new Date(project.created_at).toLocaleString() %></td>
                        </tr>
                         <tr>
                            <th scope="row">Last Updated</th>
                            <td><%= new Date(project.updated_at).toLocaleString() %></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">Project Elements</div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><a href="/projects/<%= project.id %>/tasks">Tasks (WBS)</a></li> <!-- This link will 404 for now -->
                        <li class="list-group-item"><a href="/projects/<%= project.id %>/documents">Documents</a></li><!-- This link will 404 for now -->
                        <li class="list-group-item"><a href="/projects/<%= project.id %>/logs">Daily Logs</a></li><!-- This link will 404 for now -->
                    </ul>
                </div>
            </div>
        </div>


<!-- Section for Tasks List -->
<div class="mt-5" id="project-tasks-section">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Project Tasks</h3>
        <a href="/projects/<%= project.id %>/tasks/create" class="btn btn-success">
            <i class="fas fa-plus me-1"></i> Add New Task
        </a>
    </div>

    <%- include('../partials/_messages') %> <!-- Good place for general messages related to tasks -->

    <% if (typeof tasks !== 'undefined' && tasks.length > 0) { %>
        <div class="list-group">
            <% tasks.forEach(function(task) { %>
                <div class="list-group-item list-group-item-action mb-2 shadow-sm">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1"><%= task.name %></h5>
                        <small>
                            Status: <span class="badge bg-<%= task.status === 'Completed' ? 'success' : (task.status === 'InProgress' ? 'primary' : (task.status === 'ToDo' ? 'info' : (task.status === 'Blocked' ? 'danger' : 'secondary'))) %>">
                                <%= task.status %>
                            </span>
                        </small>
                    </div>
                    <% if (task.description) { %>
                        <p class="mb-1"><%= task.description.substring(0, 200) + (task.description.length > 200 ? '...' : '') %></p>
                    <% } %>
                    <small class="text-muted">
                        Priority: <%= task.priority || 'N/A' %>
                        <% if (task.start_date || task.end_date) { %>
                            | Dates: <%= task.start_date ? new Date(task.start_date).toLocaleDateString() : 'N/A' %> - <%= task.end_date ? new Date(task.end_date).toLocaleDateString() : 'N/A' %>
                        <% } %>
                    </small>
                      <div class="mt-2">
                        <!-- TASK ACTIONS -->
                        <a href="/projects/<%= project.id %>/tasks/<%= task.id %>/edit" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-edit me-1"></i> Edit Task
                        </a>
                        
                        <!-- DELETE TASK FORM -->
                         <form action="/projects/<%= project.id %>/tasks/<%= task.id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this task? This action cannot be undone.');">
                            <button type="submit" class="btn btn-sm btn-outline-danger ms-2">
                                  <i class="fas fa-trash-alt me-1"></i> Delete </button>
                                </form>
                    </div>
<!-- 
                    <div class="mt-2">-->
                        <!-- TASK ACTIONS --> <!--
                        <a href="/projects/<%= project.id %>/tasks/<%= task.id %>/edit" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-edit me-1"></i> Edit Task
                        </a>-->
                        <!-- Placeholder for Delete button to be added later -->
                        <!--
                        <form action="/projects/<%= project.id %>/tasks/<%= task.id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this task?');">
                            <button type="submit" class="btn btn-sm btn-outline-danger ms-2">
                                <i class="fas fa-trash-alt me-1"></i> Delete
                            </button>
                        </form>
                        
                        <form action="/projects/<%= project.id %>/tasks/<%= task.id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this task? This action cannot be undone.');">
                            <button type="submit" class="btn btn-sm btn-outline-danger ms-2">
                                <i class="fas fa-trash-alt me-1"></i> Delete
                            </button>
                        </form>
                    </div>-->
                </div>
            <% }); %>
        </div>
    <% } else { %>
        <div class="alert alert-light" role="alert">
            No tasks have been added to this project yet.
            <a href="/projects/<%= project.id %>/tasks/create" class="alert-link">Add the first task now!</a>
        </div>
    <% } %>
</div>


    <% } else { %>
        <div class="alert alert-warning" role="alert">
            Project details could not be loaded.
        </div>
    <% } %>
</div>

<%- include('../partials/_footer') %>